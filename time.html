

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Time in Extempore &mdash; Extempore 0.7.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Extempore 0.7.0 documentation" href="index.html"/>
        <link rel="next" title="C-xtlang interop" href="c-xtlang-interop.html"/>
        <link rel="prev" title="Interacting with the Extempore Compiler" href="caas.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Extempore
          

          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing Extempore</a></li>
<li class="toctree-l1"><a class="reference internal" href="editor-support.html">Text editors</a></li>
<li class="toctree-l1"><a class="reference internal" href="about-this-documentation.html">About this documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Key concepts</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="philosophy.html">The Extempore philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="caas.html">Interacting with the Extempore Compiler</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Time in Extempore</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#scheduling-events-for-future-execution">Scheduling events for future execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#temporal-recursion">Temporal recursion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="c-xtlang-interop.html">C-xtlang interop</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheme-xtlang-interop.html">Scheme-xtlang interop</a></li>
<li class="toctree-l1"><a class="reference internal" href="concurrency.html">Concurrency</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory.html">Memory management in Extempore</a></li>
</ul>
<p class="caption"><span class="caption-text">xtlang</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="types.html">xtlang types</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html#primitive-types">Primitive types</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html#aggregate-types">Aggregate types</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html#named-types">Named types</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html#generics">Generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="type-inference.html">Type inferencing</a></li>
<li class="toctree-l1"><a class="reference internal" href="best-practices.html">Best practices</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials &amp; Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="audio-signal-processing.html">Audio signal processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="making-an-instrument.html">Making an instrument</a></li>
<li class="toctree-l1"><a class="reference internal" href="note-level-music.html">Playing an instrument</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-lisp-music.html">&#8220;Common Lisp Music&#8221;-style example</a></li>
<li class="toctree-l1"><a class="reference internal" href="sampler.html">Loading and using a sampler</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphics.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="impromptu-users.html">Extempore for Impromptu users</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting-help.html">Getting Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Unit testing in Extempore</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Extempore</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Time in Extempore</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/time.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="time-in-extempore">
<h1>Time in Extempore<a class="headerlink" href="#time-in-extempore" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This was once a blog post&#8212;corrections/improvements
welcome.</p>
</div>
<p>Most programming environments operate using an iterative &#8216;generate and
test&#8217; style of programming. First you write the program, then you run
the program. If there are problems with the program you re-write the
program and then re-run the program, etc…</p>
<p>Extempore is different. Extempore is a dynamic, interactive programming
environment where programs are modified and extended while they are
running. As a simple example: type the following code into your editor
and <a class="reference internal" href="caas.html"><span class="doc">evaluate</span></a> it:</p>
<div class="highlight-extempore"><div class="highlight"><pre><span class="p">(</span><span class="nf">now</span><span class="p">)</span>
</pre></div>
</div>
<p>Your editor&#8217;s echo area should display the result of evaluating the
expression, and it should be a big (integer) number&#8212;when I did it on my
computer just now it came back with <code class="docutils literal"><span class="pre">770432</span></code>.</p>
<p>Now try pressing the eval button again. It&#8217;s a different result!
<code class="docutils literal"><span class="pre">(now)</span></code> is a function that returns the time (in audio samples) since
Extempore was started. The important thing to keep in mind for the
present is that Extempore is a program that is already running.
Extempore isn&#8217;t just a programming language, or just a compiler, it&#8217;s a
run-time as well. And one of the primary differences between Extempore
and most other general purpose programming environments is an emphasis
on <em>precisely scheduled code execution</em>.</p>
<p>Each <code class="docutils literal"><span class="pre">extempore</span></code> process has a scheduling engine built-in, allowing
tasks to be scheduled for execution at a precise time in the future.
Unlike threading constructs such as <code class="docutils literal"><span class="pre">sleep()</span></code> or <code class="docutils literal"><span class="pre">wait()</span></code>, which
don&#8217;t provide strong guarantees about temporal accuracy (i.e. the time
they&#8217;ll sleep/wait for), Extempore&#8217;s scheduling engine is <em>guaranteed</em>
to execute its tasks at the requested time (the number of audio samples
since Extempore was started). This temporal guarantee is significant for
time critical domains such as audio and graphic, and real-time systems
programming.</p>
<p>Extempore&#8217;s scheduler (which what we&#8217;re accessing when we call <code class="docutils literal"><span class="pre">(now)</span></code>
is driven by the audio device which the Extempore process connected to
upon startup. This isn&#8217;t the same as the time value on the system clock,
although you can access the system clock as well through
<code class="docutils literal"><span class="pre">(clock:clock)</span></code>. Instead, the audio device will (usually) have a much
more accurate clock, running at the audio sample rate (which will
usually be 44.1kHz). That&#8217;s why Extempore <em>always</em> connects to an audio
device on startup&#8212;even if you&#8217;re not producing any audio output.</p>
<div class="section" id="scheduling-events-for-future-execution">
<h2>Scheduling events for future execution<a class="headerlink" href="#scheduling-events-for-future-execution" title="Permalink to this headline">¶</a></h2>
<p>Being able to schedule events (e.g. for music playback or even arbitrary
code execution) for execution in the future is <em>super handy</em>. As an
example, let&#8217;s load up the default synth instrument and play three notes
in sequence (an arpeggiated triad).</p>
<div class="highlight-extempore"><div class="highlight"><pre><span class="c1">;; load the instruments file</span>
<span class="p">(</span><span class="nv">sys:load</span> <span class="s">&quot;libs/core/instruments.xtm&quot;</span><span class="p">)</span>

<span class="c1">;; define a synth using the provided components</span>
<span class="c1">;; synth_note_c and synth_fx</span>
<span class="p">(</span><span class="nv">bind-instrument</span> <span class="nv">synth</span> <span class="nv">synth_note_c</span> <span class="nv">synth_fx</span><span class="p">)</span>

<span class="c1">;; add the instrument to the DSP output callback</span>
<span class="p">(</span><span class="k">bind-func</span> <span class="nf">dsp</span><span class="kt">:DSP</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">in</span> <span class="nv">time</span> <span class="nv">chan</span> <span class="nv">dat</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">synth</span> <span class="nv">in</span> <span class="nv">time</span> <span class="nv">chan</span> <span class="nv">dat</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">dsp:set!</span> <span class="nv">dsp</span><span class="p">)</span>

<span class="c1">;; schedule three nodes to play in succession</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">play-seq</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">play-note</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="nv">synth</span> <span class="mi">60</span> <span class="mi">80</span> <span class="mi">10000</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">play-note</span> <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="mi">22050</span><span class="p">)</span> <span class="nv">synth</span> <span class="mi">64</span> <span class="mi">80</span> <span class="mi">10000</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">play-note</span> <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="mi">44100</span><span class="p">)</span> <span class="nv">synth</span> <span class="mi">67</span> <span class="mi">80</span> <span class="mi">10000</span><span class="p">)))</span>

<span class="c1">;; play</span>
<span class="p">(</span><span class="nv">play-seq</span><span class="p">)</span>
</pre></div>
</div>
<p>Extempore uses an asynchronous &#8216;schedule and forget&#8217; style of
programming, often in conjunction with a design pattern called temporal
recursion&#8212;a concept I&#8217;ll come back to shortly. This is different from
languages such as ChucK which use a synchronous approach. What <em>is</em> the
difference? Synchronous timing works by holding up code until some
specified time in the future. This is basically the same concept as
using <code class="docutils literal"><span class="pre">sleep()</span></code>, although strongly timed languages like ChucK
guarantee the length of the sleep. Extempore, on the other hand, works
by scheduling tasks to be executed at some time in the future. Once a
task has been scheduled, thread execution moves immediately onto the
next expression. A pseudocode example may help to illustrate this
difference.</p>
<div class="code highlight-default"><div class="highlight"><pre><span class="o">//</span><span class="n">synchronous</span> <span class="n">timing</span>
<span class="n">play</span><span class="o">-</span><span class="n">note</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
<span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">now</span><span class="p">)</span> <span class="o">+</span> <span class="mi">44100</span>
<span class="n">play</span><span class="o">-</span><span class="n">note</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>

<span class="o">//</span><span class="n">asynchronous</span> <span class="n">timing</span>
<span class="n">play</span><span class="o">-</span><span class="n">note</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
<span class="n">play</span><span class="o">-</span><span class="n">note</span><span class="p">(</span><span class="n">now</span> <span class="o">+</span> <span class="mi">44100</span><span class="p">)</span>
</pre></div>
</div>
<p>Strongly timed code holds up thread execution until the global time is
equal to the value <code class="docutils literal"><span class="pre">time</span></code>, and multitasking is achieved by running
multiple concurrent threads of execution. The asynchronous code example
schedules tasks into the future and immediately continues execution.
Multitasking in Extempore is achieved with very little effort by
evaluating multiple simultaneous temporal recursions.</p>
<p>Asynchronous event scheduling is a fairly common programming technique,
and there wouldn&#8217;t be much else to say if Extempore wasn&#8217;t a dynamic
language. However, Extempore allows us to create and schedule code for
future execution. This turns out to be very useful in time-based
programming.</p>
</div>
<div class="section" id="temporal-recursion">
<h2>Temporal recursion<a class="headerlink" href="#temporal-recursion" title="Permalink to this headline">¶</a></h2>
<p>There is a common design pattern in Extempore programming called
<strong>temporal recursion</strong>. By writing a function which <em>schedules itself</em>
as its final action, a temporally recursive callback loop is
established. Here is an example demonstrating a <code class="docutils literal"><span class="pre">foo</span></code> function that
will play a note and then schedule itself to be called back in one
second (this loop will continue indefinitely).</p>
<div class="highlight-extempore"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="nv">foo</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">play-note</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="nv">synth</span> <span class="mi">60</span> <span class="mi">80</span> <span class="nv">*second*</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">callback</span> <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="nv">*second*</span><span class="p">)</span> <span class="ss">&#39;foo</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">foo</span><span class="p">)</span>
</pre></div>
</div>
<p>You can create as many of these temporal recursion loops as you like&#8212;try
evaluating <code class="docutils literal"><span class="pre">foo</span></code> multiple times. Notice that you get multitasking for
free, you don&#8217;t need to do anything special to run two event streams.
You can even create temporal recursions <em>inside</em> temporal recursions.</p>
<p>A temporal recursion need not &#8216;recur&#8217; at a constant rate. By adjusting
the time increment on each cycle the <code class="docutils literal"><span class="pre">callback</span></code> rate (control rate)
can be constantly adjusted. Here is an extension to the previous example
that will randomize the note length. Note that each <code class="docutils literal"><span class="pre">callback</span></code> is now
scheduled at <code class="docutils literal"><span class="pre">(now)</span></code> + the duration of the note.</p>
<p>In making this change, we&#8217;re also taking advantage of the fact that you
can re-evaluate a function while it is temporally recursing, changing
its functionality on the fly (provided that the signature of the method
does not change, i.e. same arguments and same name). Try evaluating the
code below while the old version of foo is running.</p>
<div class="highlight-extempore"><div class="highlight"><pre><span class="c1">;; re-define foo</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">foo</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">not</span><span class="nv">e-length</span> <span class="p">(</span><span class="nf">random</span> <span class="o">&#39;</span><span class="p">(</span><span class="mf">0.25</span> <span class="mf">0.5</span> <span class="mf">1.0</span> <span class="mf">2.0</span><span class="p">))))</span>
      <span class="p">(</span><span class="nv">play-note</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="nv">synth</span> <span class="p">(</span><span class="nf">random</span> <span class="mi">60</span> <span class="mi">80</span><span class="p">)</span> <span class="mi">80</span> <span class="p">(</span><span class="nf">*</span> <span class="nv">*second*</span> <span class="nv">note-length</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">callback</span> <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="p">(</span><span class="nf">*</span> <span class="nv">note-length</span> <span class="nv">*second*</span><span class="p">))</span> <span class="ss">&#39;foo</span><span class="p">))))</span>
</pre></div>
</div>
<p>In the same way, you can stop the scheduling of further notes by changing and re-evaluating <code class="docutils literal"><span class="pre">foo</span></code>
to 
<div class="highlight-extempore"><div class="highlight"><pre><span class="c1">;; re-define foo</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">foo</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>))</span>
</pre></div>
</div>
 
<p>One-off anonymous functions can also be scheduled for future evaluation.
The code example below shows a one off anonymous function scheduled for
evaluation one minute from <code class="docutils literal"><span class="pre">(now)</span></code>.</p>
<div class="highlight-extempore"><div class="highlight"><pre><span class="p">(</span><span class="nf">callback</span> <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="nv">*minute*</span><span class="p">)</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">play-note</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="nv">synth</span> <span class="mi">60</span> <span class="mi">80</span> <span class="nv">*second*</span><span class="p">)))</span>
</pre></div>
</div>
<p>There are a couple of gotchas to keep in mind when doing &#8216;schedule and
forget&#8217; programming. The first is that <code class="docutils literal"><span class="pre">(now)</span></code> can be a slippery
thing. In the example below, the two notes <em>may</em> be scheduled to play on
the same sample, but then again, they may not! <code class="docutils literal"><span class="pre">(now)</span></code> may have moved
forward in time between the two calls, even if they were evaluated at
the same time.</p>
<div class="highlight-extempore"><div class="highlight"><pre><span class="p">(</span><span class="nv">play-note</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="nv">synth</span> <span class="mi">60</span> <span class="mi">80</span> <span class="nv">*second*</span><span class="p">)</span>
<span class="p">(</span><span class="nv">play-note</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="nv">synth</span> <span class="mi">72</span> <span class="mi">80</span> <span class="nv">*second*</span><span class="p">)</span>
</pre></div>
</div>
<p>Often this lack of precision is fine (i.e. too small a change to be
noticeable) but where absolute accuracy is required a time variable
should be used.</p>
<div class="highlight-extempore"><div class="highlight"><pre><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">time</span> <span class="p">(</span><span class="nf">now</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">play-note</span> <span class="nv">time</span> <span class="nv">synth</span> <span class="mi">60</span> <span class="mi">80</span> <span class="nv">*second*</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">play-note</span> <span class="nv">time</span> <span class="nv">synth</span> <span class="mi">72</span> <span class="mi">80</span> <span class="nv">*second*</span><span class="p">))</span>
</pre></div>
</div>
<p>This inaccuracy becomes more of an issue when amplified over time, such
as using <code class="docutils literal"><span class="pre">(now)</span></code> inside a recursive callback loop. We can avoid the
problem by precisely incrementing a <code class="docutils literal"><span class="pre">time</span></code> value between each
recursive callback (note that any arguments required by the function
being called back must also be passed to <code class="docutils literal"><span class="pre">callback</span></code>).</p>
<div class="highlight-extempore"><div class="highlight"><pre><span class="c1">;; This is bad</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">loop</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">play-note</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="nv">synth</span> <span class="mi">60</span> <span class="mi">80</span> <span class="nv">*second*</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">callback</span> <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nf">now</span><span class="p">)</span> <span class="nv">*second*</span><span class="p">)</span> <span class="ss">&#39;loop</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">loop</span><span class="p">)</span>

<span class="c1">;; This is good (precise time arg is now incremented each recursion)</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">loop</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">time</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">play-note</span> <span class="nv">time</span> <span class="nv">synth</span> <span class="mi">60</span> <span class="mi">80</span> <span class="nv">*second*</span> <span class="p">)</span>
    <span class="p">(</span><span class="nf">callback</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">time</span> <span class="nv">*second*</span><span class="p">)</span> <span class="ss">&#39;loop</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">time</span> <span class="nv">*second*</span><span class="p">))))</span>

<span class="p">(</span><span class="nv">loop</span> <span class="p">(</span><span class="nf">now</span><span class="p">))</span>
</pre></div>
</div>
<p>The second major gotcha in recursive callback loops is that <code class="docutils literal"><span class="pre">(now)</span></code> is
<em>now</em>. Code requires some time to execute. If you are executing a call
to evaluate a note <code class="docutils literal"><span class="pre">(now)</span></code>, by the time the code is evaluated it will
already be late: <code class="docutils literal"><span class="pre">(now)</span></code> will have moved on. You should always try to
schedule your code execution <em>ahead</em> of the scheduled time of your
tasks.</p>
<div class="highlight-extempore"><div class="highlight"><pre><span class="c1">;; This is best (callback happens 4100 samples earlier than new time)</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">loop</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">time</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">play-note</span> <span class="nv">time</span> <span class="nv">synth</span> <span class="mi">60</span> <span class="mi">80</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">callback</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">time</span> <span class="mi">40000</span><span class="p">)</span> <span class="ss">&#39;loop</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">time</span> <span class="mi">44100</span><span class="p">))))</span>

<span class="p">(</span><span class="nv">loop</span> <span class="p">(</span><span class="nf">now</span><span class="p">))</span>
</pre></div>
</div>
<p>In the &#8216;good&#8217; version of <code class="docutils literal"><span class="pre">loop</span></code>, the <code class="docutils literal"><span class="pre">time</span></code> passed as an argument to
<code class="docutils literal"><span class="pre">loop</span></code> is exactly the same time as the scheduled callback time. The
problem with this is that the next note needs to be scheduled at exactly
the same time that the function is called. The note will always be late.
The &#8216;best&#8217; version schedules the callback just ahead of the time that we
want the note to play. This gives us <code class="docutils literal"><span class="pre">4100</span></code> samples to execute the
code to schedule the note before the note is required to sound.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="c-xtlang-interop.html" class="btn btn-neutral float-right" title="C-xtlang interop" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="caas.html" class="btn btn-neutral" title="Interacting with the Extempore Compiler" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Andrew Sorensen.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.7.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
